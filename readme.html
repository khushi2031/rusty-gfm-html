<h1>Comrak</h1>
<p><img src="https://action-badges.now.sh/kivikakk/comrak" alt="Build Status" /> <img src="https://img.shields.io/badge/specs-671%2F671-brightgreen.svg" alt="Spec Status: 671/671" /> <a href="https://opencollective.com/comrak"><img src="https://opencollective.com/comrak/all/badge.svg?label=financial+contributors" alt="Financial Contributors on Open Collective" /></a>
<a href="https://crates.io/crates/comrak"><img src="https://img.shields.io/crates/v/comrak.svg" alt="crates.io version" /></a>
<a href="https://docs.rs/comrak"><img src="https://docs.rs/comrak/badge.svg" alt="docs.rs" /></a></p>
<p>Rust port of <a href="https://github.com/github/cmark">github's <code>cmark-gfm</code></a>.</p>
<ul>
<li><a href="#installation">Installation</a></li>
<li><a href="#usage">Usage</a></li>
<li><a href="#security">Security</a></li>
<li><a href="#extensions">Extensions</a></li>
<li><a href="#related-projects">Related projects</a></li>
<li><a href="#contributing">Contributing</a></li>
<li><a href="#legal">Legal</a></li>
</ul>
<h2>Installation</h2>
<p>Specify it as a requirement in <code>Cargo.toml</code>:</p>
<pre lang="toml"><code>[dependencies]
comrak = &quot;0.8&quot;
</code></pre>
<p>Comrak supports Rust stable.</p>
<h3>Mac &amp; Linux Binaries</h3>
<pre lang="bash"><code>curl https://webinstall.dev/comrak | bash
</code></pre>
<h3>Windows 10 Binaries</h3>
<pre lang="powershell"><code>curl.exe -A &quot;MS&quot; https://webinstall.dev/comrak | powershell
</code></pre>
<h2>Usage</h2>
<pre lang="console"><code>$ comrak --help
comrak 0.8.2
Ashe Connor &lt;ashe@kivikakk.ee&gt;
A 100% CommonMark-compatible GitHub Flavored Markdown parser and formatter

USAGE:
    comrak [FLAGS] [OPTIONS] [--] [FILE]...

FLAGS:
        --escape             Escape raw HTML instead of clobbering it
        --gfm                Enable GitHub-flavored markdown extensions strikethrough, tagfilter, table, autolink, and
                             tasklist. It also enables --github-pre-lang.
        --github-pre-lang    Use GitHub-style &lt;pre lang&gt; for code blocks
        --hardbreaks         Treat newlines as hard line breaks
    -h, --help               Prints help information
        --smart              Use smart punctuation
        --unsafe             Allow raw HTML and dangerous URLs
    -V, --version            Prints version information

OPTIONS:
    -c, --config-file &lt;PATH&gt;            Path to config file containing command-line arguments, or `none' [default:
                                        /Users/kivikakk/.config/comrak/config]
        --default-info-string &lt;INFO&gt;    Default value for fenced code block's info strings if none is given
    -e, --extension &lt;EXTENSION&gt;...      Specify an extension name to use [possible values: strikethrough, tagfilter,
                                        table, autolink, tasklist, superscript, footnotes, description-lists]
    -t, --to &lt;FORMAT&gt;                   Specify output format [default: html]  [possible values: html, commonmark]
        --header-ids &lt;PREFIX&gt;           Use the Comrak header IDs extension, with the given ID prefix
        --width &lt;WIDTH&gt;                 Specify wrap width (0 = nowrap) [default: 0]

ARGS:
    &lt;FILE&gt;...    The CommonMark file to parse; or standard input if none passed

By default, Comrak will attempt to read command-line options from a config file specified by --config-file.  This
behaviour can be disabled by passing --config-file none.  It is not an error if the file does not exist.
</code></pre>
<p>And there's a Rust interface. You can use <code>comrak::markdown_to_html</code> directly:</p>
<pre lang="rust"><code>use comrak::{markdown_to_html, ComrakOptions};
assert_eq!(markdown_to_html(&quot;Hello, **世界**!&quot;, &amp;ComrakOptions::default()),
           &quot;&lt;p&gt;Hello, &lt;strong&gt;世界&lt;/strong&gt;!&lt;/p&gt;\n&quot;);
</code></pre>
<p>Or you can parse the input into an AST yourself, manipulate it, and then use your desired formatter:</p>
<pre lang="rust"><code>extern crate comrak;
use comrak::{parse_document, format_html, Arena, ComrakOptions};
use comrak::nodes::{AstNode, NodeValue};

// The returned nodes are created in the supplied Arena, and are bound by its lifetime.
let arena = Arena::new();

let root = parse_document(
    &amp;arena,
    &quot;This is my input.\n\n1. Also my input.\n2. Certainly my input.\n&quot;,
    &amp;ComrakOptions::default());

fn iter_nodes&lt;'a, F&gt;(node: &amp;'a AstNode&lt;'a&gt;, f: &amp;F)
    where F : Fn(&amp;'a AstNode&lt;'a&gt;) {
    f(node);
    for c in node.children() {
        iter_nodes(c, f);
    }
}

iter_nodes(root, &amp;|node| {
    match &amp;mut node.data.borrow_mut().value {
        &amp;mut NodeValue::Text(ref mut text) =&gt; {
            let orig = std::mem::replace(text, vec![]);
            *text = String::from_utf8(orig).unwrap().replace(&quot;my&quot;, &quot;your&quot;).as_bytes().to_vec();
        }
        _ =&gt; (),
    }
});

let mut html = vec![];
format_html(root, &amp;ComrakOptions::default(), &amp;mut html).unwrap();

assert_eq!(
    String::from_utf8(html).unwrap(),
    &quot;&lt;p&gt;This is your input.&lt;/p&gt;\n\
     &lt;ol&gt;\n\
     &lt;li&gt;Also your input.&lt;/li&gt;\n\
     &lt;li&gt;Certainly your input.&lt;/li&gt;\n\
     &lt;/ol&gt;\n&quot;);
</code></pre>
<h2>Security</h2>
<p>As with <a href="https://github.com/commonmark/cmark"><code>cmark</code></a> and <a href="https://github.com/github/cmark-gfm#security"><code>cmark-gfm</code></a>,
Comrak will scrub raw HTML and potentially dangerous links. This change was introduced in Comrak 0.4.0 in support of a
safe-by-default posture.</p>
<p>To allow these, use the <code>unsafe_</code> option (or <code>--unsafe</code> with the command line program). If doing so, we recommend the
use of a sanitisation library like <a href="https://github.com/notriddle/ammonia"><code>ammonia</code></a> configured specific to your needs.</p>
<h2>Extensions</h2>
<p>Comrak supports the five extensions to CommonMark defined in the <a href="https://github.github.com/gfm/">GitHub Flavored Markdown
Spec</a>:</p>
<ul>
<li><a href="https://github.github.com/gfm/#tables-extension-">Tables</a></li>
<li><a href="https://github.github.com/gfm/#task-list-items-extension-">Task list items</a></li>
<li><a href="https://github.github.com/gfm/#strikethrough-extension-">Strikethrough</a></li>
<li><a href="https://github.github.com/gfm/#autolinks-extension-">Autolinks</a></li>
<li><a href="https://github.github.com/gfm/#disallowed-raw-html-extension-">Disallowed Raw HTML</a></li>
</ul>
<p>Comrak additionally supports its own extensions, which are yet to be specced out (PRs welcome!):</p>
<ul>
<li>Superscript</li>
<li>Header IDs</li>
<li>Footnotes</li>
<li>Description lists</li>
</ul>
<p>By default none are enabled; they are individually enabled with each parse by setting the appropriate values in the
<a href="https://docs.rs/comrak/newest/comrak/struct.ComrakOptions.html"><code>ComrakOptions</code> struct</a>.</p>
<h2>Related projects</h2>
<p>Comrak's design goal is to model the upstream <a href="https://github.com/github/cmark-gfm"><code>cmark-gfm</code></a> as closely as possible
in terms of code structure. The upside of this is that a change in <code>cmark-gfm</code> has a very predictable change in Comrak.
Likewise, any bug in <code>cmark-gfm</code> is likely to be reproduced in Comrak. This could be considered a pro or a con,
depending on your use case.</p>
<p>The downside, of course, is that the code is not what I'd call idiomatic Rust (<em>so many <code>RefCell</code>s</em>), and while
contributors and I have made it as fast as possible, it simply won't be as fast as some other CommonMark parsers
depending on your use-case. Here are some other projects to consider:</p>
<ul>
<li><a href="https://github.com/raphlinus">Raph Levien</a>'s <a href="https://github.com/google/pulldown-cmark"><code>pulldown-cmark</code></a>. It's
very fast, uses a novel parsing algorithm, and doesn't construct an AST (but you can use it to make one if you
want). Recent <code>cargo doc</code> uses this, as do many other projects in the ecosystem. It's not quite at 100% spec
compatibility yet.</li>
<li><a href="https://github.com/bnavetta">Ben Navetta</a>'s <a href="https://github.com/bnavetta/rcmark"><code>rcmark</code></a> is a set of bindings to
<code>libcmark</code>. It hasn't been updated in a while, though there's an <a href="https://github.com/bnavetta/rcmark/pull/2">open pull
request</a>.</li>
<li>Know of another library? Please open a PR to add it!</li>
</ul>
<p>As far as I know, Comrak is the only library to implement all of the <a href="https://github.github.com/gfm">GitHub Flavored Markdown
extensions</a> to the spec, but this tends to only be important if you want to reproduce
GitHub's Markdown rendering exactly, e.g. in a GitHub client app.</p>
<h2>Contributing</h2>
<p>Contributions are highly encouraged; where possible I practice <a href="http://hintjens.com/blog:106">Optimistic Merging</a> as
described by Peter Hintjens. Please keep the <a href="CODE_OF_CONDUCT.md">code of conduct</a> in mind when interacting with this
project.</p>
<p>Thank you to comrak's many contributors for PRs and issues opened!</p>
<h3>Code Contributors</h3>
<p><a href="https://github.com/kivikakk/comrak/graphs/contributors"><img src="https://opencollective.com/comrak/contributors.svg?width=890&button=false" /></a></p>
<h3>Financial Contributors</h3>
<p>Become a financial contributor and help us sustain our community.
[<a href="https://opencollective.com/comrak/contribute">Contribute</a>]</p>
<h4>Individuals</h4>
<p><a href="https://opencollective.com/comrak"><img src="https://opencollective.com/comrak/individuals.svg?width=890"></a></p>
<h4>Organizations</h4>
<p>Support this project with your organization. Your logo will show up here with a link to your website.
[<a href="https://opencollective.com/comrak/contribute">Contribute</a>]</p>
<p><a href="https://opencollective.com/comrak/organization/0/website"><img src="https://opencollective.com/comrak/organization/0/avatar.svg"></a>
<a href="https://opencollective.com/comrak/organization/1/website"><img src="https://opencollective.com/comrak/organization/1/avatar.svg"></a>
<a href="https://opencollective.com/comrak/organization/2/website"><img src="https://opencollective.com/comrak/organization/2/avatar.svg"></a>
<a href="https://opencollective.com/comrak/organization/3/website"><img src="https://opencollective.com/comrak/organization/3/avatar.svg"></a>
<a href="https://opencollective.com/comrak/organization/4/website"><img src="https://opencollective.com/comrak/organization/4/avatar.svg"></a>
<a href="https://opencollective.com/comrak/organization/5/website"><img src="https://opencollective.com/comrak/organization/5/avatar.svg"></a>
<a href="https://opencollective.com/comrak/organization/6/website"><img src="https://opencollective.com/comrak/organization/6/avatar.svg"></a>
<a href="https://opencollective.com/comrak/organization/7/website"><img src="https://opencollective.com/comrak/organization/7/avatar.svg"></a>
<a href="https://opencollective.com/comrak/organization/8/website"><img src="https://opencollective.com/comrak/organization/8/avatar.svg"></a>
<a href="https://opencollective.com/comrak/organization/9/website"><img src="https://opencollective.com/comrak/organization/9/avatar.svg"></a></p>
<h2>Legal</h2>
<p>Copyright (c) 2017–2020, Ashe Connor. Licensed under the <a href="https://opensource.org/licenses/BSD-2-Clause">2-Clause BSD
License</a>.</p>
<p><code>cmark</code> itself is is copyright (c) 2014, John MacFarlane.</p>
<p>See <a href="COPYING">COPYING</a> for all the details.</p>

